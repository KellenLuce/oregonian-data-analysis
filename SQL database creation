
CREATE SCHEMA f_proj;


CREATE TABLE f_proj.articles_raw (
	
	headline TEXT,
	author TEXT,
	"label" TEXT,
	date_updated TEXT,
	date_published TEXT,
	share_count TEXT,
	article TEXT

);

COPY f_proj.articles_raw
FROM ''
WITH (FORMAT CSV, HEADER);

COPY f_proj.articles_raw
FROM ''
WITH (FORMAT CSV, HEADER);

CREATE TABLE f_proj.articles_cleaner (
	"id" SERIAL,
	headline TEXT,
	author TEXT,
	author_id INT,
	newspaper TEXT,
	"label" TEXT,
	date_updated TIMESTAMP,
	date_published TIMESTAMP,
	share_count INT,
	article TEXT,
	twitter TEXT
);

/* started cleaning */

BEGIN;

UPDATE f_proj.articles_raw
SET author = ltrim(author, 'By ')
;

COMMIT;


ALTER TABLE f_proj.articles_raw
ADD COLUMN article_id SERIAL;


DELETE FROM f_proj.articles_raw
WHERE article_id NOT IN (
	SELECT MAX(article_id)
	FROM f_proj.articles_raw
	GROUP BY headline, author, "label", date_updated, date_published, share_count, article
	)
;
/* note that above leaves duplicated articles that have two different share_counts. */
/* fixing that data + type */

UPDATE f_proj.articles_raw
SET share_count = 0
WHERE share_count = 'None'
;

ALTER TABLE f_proj.articles_raw
ALTER COLUMN share_count SET DATA TYPE INT USING share_count::INT
;

/* fixing the update + publication dates too */

UPDATE f_proj.articles_raw
SET date_updated = ltrim(date_updated, 'Updated: ')
;





